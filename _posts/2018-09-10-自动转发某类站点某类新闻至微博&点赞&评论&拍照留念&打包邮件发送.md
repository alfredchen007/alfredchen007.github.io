---
layout: post

title: "è‡ªåŠ¨è½¬å‘æŸç±»ç«™ç‚¹æŸç±»æ–°é—»è‡³å¾®åš&ç‚¹èµ&è¯„è®º&æ‹ç…§ç•™å¿µ&æ‰“åŒ…é‚®ä»¶å‘é€"

date: 2018-9-12 00:23:20 +0300

description:  

cover: 'http://pdsw7h3kf.bkt.clouddn.com/2018-09-15-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-09-15%20%E4%B8%8B%E5%8D%886.43.58.png'

color: rgb(98,170,255)

tags: [Python,Selenium]
---

> Life is short, you need Python.<!-- more -->

### é¦–å…ˆï¼Œè¿™æ˜¯ä¸€ä¸ªä¼ªéœ€æ±‚

é™¤äº†é¥è¿œè¯»ä¹¦æ—¶æœŸçš„å¤§å¤§å°å°ä½œä¸šï¼Œè¿™ä¹ˆæ­£ï¼ˆdanï¼‰ç»ï¼ˆtengï¼‰çš„éœ€æ±‚åœ¨ç°å®ç”Ÿæ´»ä¸­ç«Ÿç„¶è¿˜æ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°ï¼š

- è½¬å‘æŸç±»æ–‡ç« æˆ–æŠ¥é“è‡³ä¸ªäººå¾®åšï¼ˆåº”ç›¸å…³ç‰¹æ®Šè¦æ±‚ï¼Œä¸èƒ½ä½¿ç”¨å°å·ï¼Œå¿…é¡»æ˜¯çœŸå®çš„ä¸ªäººè´¦å·ï¼‰
- å¯¹è½¬å‘çš„æ–‡ç« ç‚¹èµ
- å¯¹å¾®åšè¿›è¡Œç‚¹è¯„ï¼ˆå¯ä»¥æ˜¯è‡ªå·±çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»–äººçš„ï¼‰
- å¯¹ä»¥ä¸Šæ“ä½œæˆªå›¾ï¼Œè¯æ˜æˆ‘æ›¾æ¥è¿‡
- å°†æˆªå›¾æ–‡ä»¶æ‰“åŒ…æ±‡æ€»ã€å‘é‚®ä»¶

é¢å¯¹å¦‚æ­¤æ­£ç»çš„éœ€æ±‚ï¼Œäººç”Ÿè‹¦çŸ­ï¼Œä½ éœ€è¦Python

### Login&Post

å¯¹äºå‘é€å¾®åšæœ‰å¤šç§å®ç°æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨å»–ç¥çš„SDKï¼Œéœ€è¦[ä¸‹è½½](http://open.weibo.com/wiki/SDK#Python_SDK)ï¼ˆç‚¹å‡»ä¸‹è½½ï¼‰ï¼ŒåŠŸèƒ½æ¯”è¾ƒç®€å•ä¹Ÿå¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œè¿™é‡Œä¸é‡‡ç”¨SDKçš„æ–¹æ³•ï¼Œä¾¿äºæˆ‘ä»¬æ§åˆ¶æµ‹è¯•ã€‚

### Login

å¯¹æ¯”äº†ç½‘ä¸Šçš„å‡ ç±»æ–¹æ³•ï¼Œå‘ç°è²Œä¼¼ä½¿ç”¨[requests](https://pypi.python.org/pypi/requests)ç›¸æ¯”äºæ¯”urllib2å®ç°èµ·æ¥æ›´ç®€æ´ï¼Œè¿™é‡Œæ²¡æœ‰å¯¹æ¯”äºŒè€…æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºç›®å‰åªæ˜¯ä¸ªäººä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è®¾è®¡æˆæœåŠ¡ã€‚

```shell
pip3 install requests
pip3 install rsa
```

```python
def wblogin():
    username = USER_NAME
    password = PASSWD
    resp = session.get(
        'http://login.sina.com.cn/sso/prelogin.php?'
        'entry=weibo&callback=sinaSSOController.preloginCallBack&'
        'su=%s&rsakt=mod&checkpin=1&client=%s' %
        (base64.b64encode(username.encode('utf-8')), WBCLIENT)
    )

    pre_login_str = re.match(r'[^{]+({.+?})', resp.text).group(1)
    pre_login = json.loads(pre_login_str)
    data = {
        'entry': 'weibo',
        'gateway': 1,
        'from': '',
        'savestate': 7,
        'userticket': 1,
        'ssosimplelogin': 1,
        'su': base64.b64encode(requests.utils.quote(username).encode('utf-8')),
        'service': 'miniblog',
        'servertime': pre_login['servertime'],
        'nonce': pre_login['nonce'],
        'vsnf': 1,
        'vsnval': '',
        'pwencode': 'rsa2',
        'sp': encrypt_passwd(password, pre_login['pubkey'],
                             pre_login['servertime'], pre_login['nonce']),
        'rsakv': pre_login['rsakv'],
        'encoding': 'UTF-8',
        'prelt': '53',
        'url': 'http://weibo.com/ajaxlogin.php?framelogin=1&callback=parent.si'
               'naSSOController.feedBackUrlCallBack',
        'returntype': 'META'
    }

    login_url_list = 'http://login.sina.com.cn/sso/login.php?client=%s' % WBCLIENT
    resp = session.post(login_url_list, data=data)
    match_obj = re.search('replace\\(\'([^\']+)\'\\)', resp.text)
    if match_obj is None:
        logger.info('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç™»å½•ä¿¡æ¯')
        return (session, None)

    login_url = match_obj.group(1)
    resp = session.get(login_url)
    login_str = login_str = re.search('\((\{.*\})\)', resp.text).group(1)
    login_info = json.loads(login_str)
    logger.info("login successï¼š[%s]" % str(login_info))
    uniqueid = login_info["userinfo"]["uniqueid"]
    return (session, uniqueid)
```

### Post 

ä»£ç ä¸­å‘é€å¾®åšä½¿ç”¨çš„æ¥å£ä¸º`"https://www.weibo.com/aj/mblog/add?ajwvr=6&__rnd=%d" % int(time.time() * 1000`ï¼Œç­‰å·åé¢ä¸ºæ—¶é—´æˆ³ï¼Œä½¿ç”¨`int(time.time() * 1000`è®¾ç½®

```python
class WeiboSender(object):

    def __init__(self, session, uid):
        super(WeiboSender, self).__init__()
        self.session = session
        self.uid = str(uid)
        self.Referer = "http://www.weibo.com/u/%s/home?wvr=5" % self.uid

    def send_weibo(self, weibo):
        if not isinstance(weibo, WeiboMessage):
            raise ValueError('weibo must WeiboMessage class type')
            logger.debug('weibo must WeiboMessage class type')
        if weibo.is_empty:
            logger.info('æ²¡æœ‰è·å¾—ä¿¡æ¯ï¼Œä¸å‘é€')
            return

        pids = ''
        if weibo.has_image:
            pids = self.upload_images(weibo.images)
        data = weibo.get_send_data(pids)
        self.session.headers["Referer"] = self.Referer
        try:
            self.session.post("https://www.weibo.com/aj/mblog/add?ajwvr=6&__rnd=%d"
                              % int(time.time() * 1000),
                              data=data)
            logger.info('å¾®åš[%s]å‘é€æˆåŠŸ' % str(weibo))
        except Exception as e:
            logger.debug(e)
            logger.info('å¾®åš[%s]å‘é€å¤±è´¥' % str(weibo))
```



### è·å–ç½‘é¡µæ–°é—»

è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„çˆ¬è™«åœºæ™¯ï¼Œå¤§åé¼é¼è¯¸å¦‚[Scrapy](https://scrapy.org/)ã€[PySpider](https://github.com/binux/pyspider)ã€[Crawley](http://project.crawley-cloud.com/)ã€[Portia](https://github.com/scrapinghub/portia)ç­‰ç­‰å„ç§æ¡†æ¶å‡å¯è½»æ¾åº”å¯¹ï¼Œä½†è¿™å¯¹æˆ‘ä»¬è¿™ç§æ­£ç»éœ€æ±‚æ¥è¯´éƒ½å¤ªé‡äº†ï¼Œæˆ‘ä»¬ä½¿ç”¨ **[Beautiful Soup](https://www.crummy.com/software/BeautifulSoup/bs4/doc/)** pythonåº“è¿™ä¸ªè½»é‡çº§é€‰æ‰‹æ­é…`requests`å¯ä»¥å¾ˆç®€æ´åœ°å®ç°ï¼ˆç»æ½‡æ´’å“¥è®¤è¯è¿‡çš„å°±æ˜¯å¥½ ï¼‰ã€‚

```python
from spider.eastmoney import EastmoneyParser
from spider.guba import GubaParser
from spider.ifeng import IfengParser
from spider.csrc import CsrcParser

spiders = [
    EastmoneyParser(), #ä¸œæ–¹è´¢å¯Œç½‘
    IfengParser(),     #å‡¤å‡°è´¢ç»
    GubaParser(),      #è‚¡å§è®ºå›
    CsrcParser()       #è¯ç›‘ä¼šæ–°é—»å‘å¸ƒé¡µé¢
]

currentIndex = 0
count = len(spiders)

def nextSpider():
    global currentIndex
    spider = spiders[currentIndex]
    currentIndex = (currentIndex + 1) % count
    print(currentIndex)
    return spider
```

å› ä¸ºæ–°é—»å¯èƒ½æ¥æºäºå¤šä¸ªæ¸ é“ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ªçˆ¬è™«å®¹å™¨ä¿å­˜`spider`å¯¹è±¡ï¼Œæ¯ä¸ªçˆ¬è™«å¯¹è±¡å®ç°è‡ªå·±çš„è§£æå™¨å°±å¯ä»¥äº†ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿åç»­æ·»åŠ å…¶ä»–æ–°é—»çˆ¬è™«æ¸ é“ï¼Œåªéœ€è¦å®ç°è¦å¢åŠ çš„çˆ¬è™«å¯¹è±¡å¹¶åœ¨å®¹å™¨ä¸­æ‰©å±•å°±å¯ä»¥äº†ã€‚`nextSpider`æ–¹æ³•ç®€å•å®ç°äº†å¯¹äºå·²æœ‰çˆ¬è™«çš„è½®è¯¢ã€‚

```python
class Spider(object):
    '''spider base class'''

    def __init__(self, home_url):
        super(Spider, self).__init__()
        self.home_url = home_url
        self.session = requests.session()
        self.session.headers['User-Agent'] = USER_AGENT

    def download_text(self):
        '''get raw text such as htmlã€jsonã€or so on'''
        resp = self.session.get(self.home_url)
        resp.encoding = "utf-8"
        return resp.text

    def get_weibo_message(self):
        pass
```

åœ¨åˆ›å»º`Spider`å¯¹è±¡æ—¶ï¼Œç”±äºå®šä¹‰äº†è§£æçš„å±æ€§ï¼Œæ‰€ä»¥åªéœ€è¦æ³¨å…¥ä¸åŒçš„è§£æå¯¹è±¡ï¼Œå°±èƒ½è§£æä¸åŒçš„ç½‘ç«™å†…å®¹äº†ã€‚ç›®å‰åªå®ç°äº†***ä¸œæ–¹è´¢å¯Œç½‘***ã€***å‡¤å‡°è´¢ç»***ã€***è‚¡å§è®ºå›***ã€***è¯ç›‘ä¼šæ–°é—»å‘å¸ƒ***é¡µé¢çš„çˆ¬è™«ï¼Œå¦‚æœåç»­æ‰©å±•å…¶å®ƒçš„åª’ä½“æ¸ é“ï¼Œåªè¦å®ç°ç›¸åº”çš„`Parser`ç±»ï¼Œå¹¶åœ¨å®¹å™¨ä¸­æ·»åŠ å³å¯ã€‚ä»¥**[ä¸œæ–¹è´¢å¯Œç½‘çš„wapç‰ˆ](https://emwap.eastmoney.com/)**ä¸ºä¾‹ï¼ˆwapç‰ˆé¡µé¢å…ƒç´ è¾ƒå°‘ï¼Œæ¯”è¾ƒå®¹æ˜“å®šä½ï¼‰ï¼Œå¦‚ä¸‹ï¼š

![](http://pdsw7h3kf.bkt.clouddn.com/2018-09-14-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-09-14%20%E4%B8%8B%E5%8D%886.48.19.png)

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦çš„æ–°é—»ç±»å‹ï¼ˆä»Šæ—¥èšç„¦ï¼‰åœ¨`comm-list`çš„classä¸­ï¼Œæ¯ä¸ª`dd`æ ‡ç­¾ä¸­åŒ…å«ä¸€æ¡æ–°é—»ï¼Œæˆ‘ä»¬åªè¦å®šä½åˆ°æ‰€æœ‰çš„`a`æ ‡ç­¾ï¼Œå¹¶å°†`a`æ ‡ç­¾çš„`text`å†…å®¹è§£æå‡ºæ¥å³ä¸ºæ–°é—»çš„titleï¼Œ`href`è§£æå‡ºæ¥å³ä¸ºæ–°é—»çš„é“¾æ¥ï¼Œå½“ç„¶è¿™é‡Œéœ€è¦ä½¿ç”¨æ ¹urlè¿›è¡Œæ‹¼æ¥ä¸€ä¸‹ï¼Œè¿™ä¸¤éƒ¨åˆ†çš„ç»„åˆå³æ„æˆäº†æˆ‘ä»¬å¾®åšçš„å†…å®¹ã€‚

```python
# -*- coding: utf-8 -*-

from __future__ import absolute_import
import bs4
import re
from spider.spider import Spider
from weibo.weibo_message import WeiboMessage

HOME_URL = "https://emwap.eastmoney.com"


class EastmoneyParser(Spider):

    def __init__(self):
        super(EastmoneyParser, self).__init__(HOME_URL)

    def get_weibo_message(self):
        html = self.download_text()
        soup = bs4.BeautifulSoup(html, "html.parser")
        div = soup.find(attrs={"class": "comm-list"})
        items = div.find_all('dd')
        msg = ''
        weiboList = []
        
        if len(items) > 0:        
            for item_num in range(1, len(items)):
                item = items[item_num]
                title = item.a.string.strip()
                # è¯ç›‘ä¼š æ·±äº¤æ‰€ ä¸Šäº¤æ‰€ æ²ªæ·± è¯åˆ¸ å¤®è¡Œ ç›‘ç®¡
                if re.match(u'^\u8bc1\u76d1\u4f1a', title) or \
                   re.match(u'^\u6df1\u4ea4\u6240', title) or \
                   re.match(u'^\u4e0a\u4ea4\u6240', title) or \
                   re.match(u'^\u6caa\u6df1', title) or \
                   re.match(u'^\u8bc1\u5238', title) or \
                   re.match(u'^\u592e\u884c', title) or \
                   re.match(u'^\u76d1\u7ba1', title): 
                    url = item.a.get('href')
                    url = HOME_URL + url
                    msg = "%s %s" % (title, url)
                    weiboList.append(WeiboMessage(msg))
        return weiboList
```

ä½¿ç”¨reæ¨¡å—å¯¹æ–°é—»çš„æ ‡é¢˜åšä¸€ä¸ªç®€å•çš„åŒ¹é…è¿‡æ»¤ï¼Œè¿™é‡Œå·²å®šä¹‰å¥½ä¸€äº›å…³é”®å­—ï¼Œå°±ç›´æ¥å†™åœ¨äº†ç¨‹åºä¸­ï¼Œå¦‚æœåç»­å…³é”®å­—æ¯”è¾ƒå¤šå¯ä»¥ä¼˜åŒ–æˆå­—å…¸

ä¸€æ¬¡çˆ¬è™«å¯ä»¥è·å–å¹¶æ„å»º`0-n`æ¡å¾®åšå†…å®¹ï¼Œæœ€åå°†æ‰€æœ‰çš„å¾®åšæ¶ˆæ¯åˆ—è¡¨ä»¥`list`è¿”å›ã€‚åœ¨å‘é€å¼•æ“ç±»ä¸­ä½¿ç”¨æ–¹æ³•`sendWeibo`è°ƒç”¨spiderå¯¹è±¡ä¸­çš„`get_weibo_message`ï¼Œè·å–çˆ¬åˆ°çš„å¾®åšæ¶ˆæ¯`list`ï¼Œé€æ¡å‘é€å¾®åšå³å¯ï¼Œé—´éš”3ç§’ä»¥é˜²æ­¢è¢«å±è”½ã€‚

```python
class SendTask(Thread):

    def __init__(self, http, uid):
        Thread.__init__(self)
        self.stopped = Event()
        self.sender = WeiboSender(http, uid)

    def run(self):
        logger.info("starting web comment task...\n")
        self.sendWeibo()
        while not self.stopped.wait(TIME_SLOG):
            self.sendWeibo()
        logger.info("end web comment task...\n")

    def stop(self):
        self.stopped.set()

    def sendWeibo(self):
        spider = spider_factory.nextSpider()
        weiboList = []
        weiboList = spider.get_weibo_message()
        for weibo in weiboList:
            self.sender.send_weibo(weibo)
            logger.info("wait 3 second\n")
            time.sleep(3)
```

å‘é€å¾®åšçš„æ¥å£å®ç°å‚è€ƒäº†ç½‘ä¸Šçš„æ–¹æ³•ï¼Œä¿®æ”¹åå¢åŠ äº†ä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½ï¼ˆä¸è¿‡è²Œä¼¼åœ¨æˆ‘ä»¬æ­£ç»çš„éœ€æ±‚ä¸­ä¹Ÿç”¨ä¸åˆ°ï¼‰ï¼Œè¯¦ç»†çš„ä»£ç åé¢å°†æ‰˜ç®¡åˆ°githubä¸Šã€‚

### è‡ªåŠ¨ç™»å½•+è‡ªåŠ¨ç‚¹èµ+è‡ªåŠ¨è¯„è®º+æ‹ç…§ç•™å¿µ

è¿™ä¸ªæµç¨‹ï¼Œå¬èµ·æ¥ï¼Œç‰¹åˆ«åœ°åƒåšè‡ªåŠ¨åŒ–æµ‹è¯•çš„åŒå­¦ï¼Œæ‰€ä»¥ï¼Œwebè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶**[*Selenium*](http://www.baidu.com/link?url=oiUuI9A5ZzMupj_DtzxeWSSY0uf0tk9hSvsUyC-mN9_XRETWy7FyWNtETaaUhuDr)**ï¼Œä½ å€¼å¾—æ‹¥æœ‰ã€‚`Selenium`æµ‹è¯•ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå°±åƒçœŸæ­£çš„ç”¨æˆ·åœ¨æ“ä½œä¸€æ ·ï¼Œå¯ä»¥æµ‹è¯•ä¸å„ç±»æµè§ˆå™¨çš„å…¼å®¹æ€§ã€‚æ”¯æŒçš„æµè§ˆå™¨åŒ…æ‹¬IEï¼ˆ7, 8, 9, 10, 11ï¼‰ï¼ŒMozilla Firefoxï¼ŒSafariï¼ŒGoogle Chromeï¼ŒOperaç­‰

```
pip3 install selenium
```

å‡†å¤‡ä½ æœ¬åœ°çš„driverï¼Œæˆ‘ç”¨çš„æ˜¯chromeï¼ŒæŸ¥çœ‹chromeå¯¹åº”çš„ç‰ˆæœ¬

![](http://pdsw7h3kf.bkt.clouddn.com/2018-09-14-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-09-14%20%E4%B8%8B%E5%8D%887.44.43.png)

å¹¶é€‰æ‹©å¯¹è¯¥ç‰ˆæœ¬æ”¯æŒçš„[chromedriver](http://npm.taobao.org/mirrors/chromedriver/)

![](http://pdsw7h3kf.bkt.clouddn.com/2018-09-14-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-09-14%20%E4%B8%8B%E5%8D%887.48.39.png)

`nodes`æ–‡æœ¬æ–‡ä»¶ä¸­åŒ…å«äº†ç‰ˆæœ¬æ”¯æŒè¯´æ˜

![](http://pdsw7h3kf.bkt.clouddn.com/2018-09-14-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-09-14%20%E4%B8%8B%E5%8D%887.49.28.png)

### login

```python
def driver_login(url, driver_location, username, passwd):
    """ ä½¿ç”¨webdriverç™»å½•ï¼š 
    url-ç™»å½•åœ°å€
    driver_location-æœ¬åœ°driverè·¯å¾„
    username-ç”¨æˆ·å
    passwd-å¯†ç  """
    driver = webdriver.Chrome(driver_location)
    driver.maximize_window()
    driver.implicitly_wait(7)
    driver.get(url)
 #  driver.find_element_by_id("loginName").clear()
    driver.find_element_by_id("loginName").send_keys(username)
    driver.find_element_by_id("loginPassword").send_keys(passwd)
    driver.find_element_by_id("loginAction").click()
    time.sleep(5)
    return driver
```

åœ¨ç™»å½•æ—¶ä½¿ç”¨`webdriver.Chrome()`åˆå§‹åŒ–ä¸€ä¸ª`driver`ï¼Œé€šè¿‡å…ƒç´ å®šä½ï¼ˆé€šè¿‡`id`ï¼‰æ‰¾åˆ°ç™»å½•æ¡†å¹¶å‘é€ç”¨æˆ·åå¯†ç åæäº¤ï¼Œå°†driverè¿”å›ã€‚å…ƒç´ å®šä½æ–¹æ³•æœ‰å¤šç§ï¼Œæ ¹æ®é¡µé¢çš„å…·ä½“æƒ…å†µå¯æ­é…ä½¿ç”¨ï¼Œåé¢å°†ä¼šæœ‰å…¶å®ƒç¤ºä¾‹ã€‚

### praise & comment

è‡ªåŠ¨ç‚¹èµä¸è‡ªåŠ¨è¯„è®ºçš„è¿‡ç¨‹åœ¨`weibo_process_handler`ä¸­å®ç°

```python
def weibo_process_handler():
    """ å¤„ç†å‘é€åçš„å¾®åšï¼š è‡ªåŠ¨ä¸ºå·²å‘å¾®åšç‚¹èµ   è‡ªåŠ¨å‘é€è¯„è®º   è°ƒç”¨captureæ–¹æ³•ç”Ÿæˆæˆªå›¾ """
    
    driver = driver_login(url, DRIVER_LOCATION, USER_NAME, PASSWD)
    
    driver.find_element_by_xpath('//*[@id="app"]/div[1]/div[1]/div[1]/div[1]').click()
   # ActionChains(driver).move_to_element(top)
    time.sleep(5)
    count_like = 0

    for count_weibo in range(1, 11):
        #try:
        # ç­‰å¾…é¡µé¢åŠ è½½å‡ºèµ
        WebDriverWait(driver, 10, 1).until(expected_conditions.presence_of_element_located(
        (By.XPATH, '//*[@id="app"]/div[1]/div['+str(count_weibo + 1)+']/div/div/footer/div[3]/i'))
        )
        #æ‰¾åˆ°èµçš„å…ƒç´ å¹¶å‘é€ç‚¹å‡»
        like_btn = driver.find_element_by_xpath('//*[@id="app"]/div[1]/div['+str(count_weibo + 1)+']/div/div/footer/div[3]/i')
        like_btn.click()
        time.sleep(1)
        count_like += 1
        #æ‰¾åˆ°è¯„è®ºçš„å…ƒç´ å¹¶ç‚¹å‡»

        comment_btn = driver.find_element_by_xpath('//*[@id="app"]/div[1]/div['+str(count_weibo + 1)+']/div/div/footer/div[2]/i')
        comment_btn.click()

        #å®šä½åˆ°è¯„è®ºæ¡†å¹¶å‘é€è¯„è®ºæ–‡å­—
        if findElementByXpath(driver,'//*[@id="app"]/div[1]/div/main/div[1]/div/span/textarea[1]'):
            comment_input = driver.find_element_by_xpath('//*[@id="app"]/div[1]/div/main/div[1]/div/span/textarea[1]')
            comment_input.send_keys(choice(comment))
            time.sleep(5)
            if findElementByXpath(driver, '//*[@id="app"]/div[1]/div/header/div[3]/a'):
                ActionChains(driver).click(driver.find_element_by_xpath('//*[@id="app"]/div[1]/div/header/div[3]/a')).perform()

        elif findElementByXpath(driver,'//*[@id="app"]/div[1]/div/div[5]/div/div[1]/span'):
            driver.find_element_by_xpath('//*[@id="app"]/div[1]/div/div[5]/div/div[1]/span').click()

            comment_input = driver.find_element_by_xpath('//*[@id="app"]/div[1]/div/div[5]/div/div/div/div[1]/textarea[1]')
            comment_input.send_keys(choice(comment))
            time.sleep(5)
            ActionChains(driver).click(driver.find_element_by_xpath('//*[@id="app"]/div[1]/div/div[5]/div/div/div/div[2]/button')).perform()
            time.sleep(3)
            #back_btn = driver.find_element_by_xpath('//*[@id="app"]/div[1]/div/div[1]/div[1]/i')
            #back_btn.click()
            driver.back()
        else:
            print('textarea is not found')
            return False
                  
        print(count_like)
        
        # åˆ›å»ºæˆªå›¾çš„å­˜å‚¨è·¯å¾„ï¼Œä»¥æ—¶é—´æ–¹å¼å‘½å
        current_time_short = time.strftime("%Y-%m-%d", time.localtime(time.time()))
        crnt_path = os.path.abspath('.')    
        pic_path = os.path.join(crnt_path, 'result', current_time_short)
        isExists = os.path.exists(pic_path)
        # å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ›å»ºè·¯å¾„
        if not isExists:
            os.makedirs(pic_path)
        # åˆ›å»ºæˆªå›¾çš„å‘½åï¼Œä»¥â€œå¹´-æœˆ-æ—¥-æ—¶-åˆ†-ç§’â€çš„æ—¶é—´æ ¼å¼å‘½åï¼Œä»¥pngä¸ºåç¼€ 
        current_time_long = time.strftime("%Y-%m-%d-%H_%M_%S", time.localtime(time.time()))          
        pic_path_test = pic_path + '/' + current_time_long + '.png'

        #æ¯éš”1så®šä½å¾®åšä¸ªäººé¡µé¢å…ƒç´ ï¼Œé˜²æ­¢å…ƒç´ æš‚æ²¡æœ‰åŠ è½½å‡ºæ¥ï¼Œè¶…æ—¶æ—¶é—´ä¸º5s
        WebDriverWait(driver, 5 , 1).until(expected_conditions.presence_of_element_located(
        (By.XPATH, '//*[@id="app"]/div[1]/div['+str(count_weibo + 1)+']/div/div/footer/div[3]/i'))
        )
        #ä¿å­˜æˆªå›¾
        driver.get_screenshot_as_file(pic_path_test)
    #driver.refresh()
        time.sleep(5)
    #capture(driver, 1920, 906, pic_path)
    driver.quit()
```

åœ¨å¤„ç†ç‚¹èµã€è¯„è®ºã€è¿”å›ä¸ªäººé¡µé¢æ—¶ï¼Œç½‘ç»œçŠ¶æ€å¯èƒ½ä¼šå½±å“åˆ°å…ƒç´ åŠ è½½çš„é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç”¨WebDriverWait()æ–¹æ³•æ¥ç­‰å¾…å…ƒç´ çš„åŠ è½½

![](http://pdsw7h3kf.bkt.clouddn.com/2018-09-15-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-09-15%20%E4%B8%8B%E5%8D%886.24.51.png)

| driver                 | ä¼ å…¥WebDriverå®ä¾‹ï¼Œå³æˆ‘ä»¬ä¸Šä¾‹ä¸­çš„driver                      |
| ---------------------- | ------------------------------------------------------------ |
| **timeout**            | **è¶…æ—¶æ—¶é—´ï¼Œç­‰å¾…çš„æœ€é•¿æ—¶é—´ï¼ˆåŒæ—¶è¦è€ƒè™‘éšæ€§ç­‰å¾…æ—¶é—´ï¼‰**       |
| **poll_frequency**     | **è°ƒç”¨untilæˆ–until_notä¸­çš„æ–¹æ³•çš„é—´éš”æ—¶é—´ï¼Œé»˜è®¤æ˜¯0.5ç§’**      |
| **ignored_exceptions** | **å¿½ç•¥çš„å¼‚å¸¸ï¼Œå¦‚æœåœ¨è°ƒç”¨untilæˆ–until_notçš„è¿‡ç¨‹ä¸­æŠ›å‡ºè¿™ä¸ªå…ƒç»„ä¸­çš„å¼‚å¸¸ï¼Œåˆ™ä¸ä¸­æ–­ä»£ç ï¼Œç»§ç»­ç­‰å¾…ï¼Œå¦‚æœæŠ›å‡ºçš„æ˜¯è¿™ä¸ªå…ƒç»„å¤–çš„å¼‚å¸¸ï¼Œåˆ™ä¸­æ–­ä»£ç ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚é»˜è®¤åªæœ‰NoSuchElementException** |

æŸ¥æ‰¾å…ƒç´ æ—¶æœ‰éƒ¨åˆ†ä½¿ç”¨äº†`find_element_by_xpath`æ–¹æ³•ï¼Œå³é€šè¿‡å…ƒç´ çš„xpathå®šä½ï¼Œè¯¥æ–¹æ³•å¤±è´¥å°†ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬å°†è¯¥æ–¹æ³•å°è£…ä¸€ä¸‹ï¼Œç›´æ¥æ ¹æ®è¿”å›å€¼åœ¨ç¨‹åºä¸­å®ç°é€»è¾‘æ§åˆ¶ã€‚

```python
def findElementByXpath(driver, element):
    flag = True
    try:
        driver.find_element_by_xpath(element)
        return flag
    except:
        flag = False
        return flag
```

### mail delivery

ä½¿ç”¨`import smtplib`å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä»¥é™„ä»¶æ–¹å¼å‘é€æˆªå›¾ï¼Œç•™å‘å¾…å¡«

btwï¼Œè¦æ³¨æ„ä½¿ç”¨ç½‘æ˜“é‚®ç®±å‘é€æ—¶ï¼Œéœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯æˆæƒç ä»£æ›¿å¯†ç ï¼Œå¦åˆ™ä¼šå‡ºç°535æŠ¥é”™ã€‚

### In the end

è¿è¡Œä¸€ä¸ªæ˜ŸæœŸå·¦å³ï¼ŒåŸºæœ¬ç¨³å®šã€‚æœ€åå‘é€å‡ºçš„å¾®åšæ¶ˆæ¯ä¸æˆªå›¾å¤§è‡´å¦‚ä¸‹å·¦åŠéƒ¨åˆ†æ‰€ç¤ºï¼Œç»™è‡ªå·±çš„é¡µé¢ä¹Ÿç‚¹ä¸ªèµğŸ˜‚

![](http://pdsw7h3kf.bkt.clouddn.com/2018-09-15-%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-09-15%20%E4%B8%8B%E5%8D%886.49.07.png)

