---
layout: post

title: "MySQL-Note-3ï¼šTransaction Isolation"

date: 2019-04-28 20:50:20 +0300

description:  

cover: 'https://jc-1258611203.cos.ap-beijing.myqcloud.com/blog/2019-03-29-MySQL-header.png'

color: rgb(412,115,233)

tags: [MySQL]
---



##### æ¯æ¬¡å¼€å§‹å‰çš„çµ®å¨

å¤©æ´¥å›¾ä¹¦å¤§åŽ¦ï¼ŒHola Zumba Studioï¼Œä¸­åˆä¼‘æ¯ï¼Œä¸‹åˆè€ƒè¯•ã€‚åŸ¹è®­çš„å¼ºåº¦å¤ªå¤§äº†ï¼Œä½†å¥½å¤„å°±æ˜¯ä½ ä¸€çœ¼å°±èƒ½åŒºåˆ†å‡ºæ¯ä¸ªäººçš„å¹´é¾„æ®µï¼Œå–ä¸€ç“¶æ°´å°±èƒ½è¹¦ä¸€å¤©çš„æ˜¯ 00 åŽï¼Œåƒä¸¤å£å·§å…‹åŠ›å°±æ¢å¤ä½“åŠ›çš„æ˜¯ 95 åŽï¼Œ90 å¹´çš„æˆ‘åªèƒ½æŽå‡ºä¿æ¸©æ¯èº²åœ¨è§’è½é‡Œç‘Ÿç‘Ÿå‘æŠ–åœ°åƒç…Žé¥¼æžœå­ã€‚å—æ¥¼ç…Žé¥¼ä¹Ÿå¤ªå¥½åƒäº†å­ï¼åƒå®Œç å­—ï¼

### äº‹åŠ¡

å­¦è®¡ç®—ðŸ”çš„ç«¥éž‹ä»¬éƒ½çŸ¥é“ï¼Œäº‹åŠ¡å°±æ˜¯è¦ä¿è¯ä¸€ç»„æ•°æ®åº“æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨ MySQL ä¸­äº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“Žå±‚å®žçŽ°çš„ã€‚è¿˜è®°å¾—å‰é¢ç”»çš„é‚£å¼ å›¾å—ï¼ˆåŽŸè°…æˆ‘ç”»çš„å¤ªç³Ÿç³•ï¼Œå°±ä¸æ”¾äº†ï¼Œå‰ä¸¤ç¯‡ç¬”è®°é‡Œéƒ½æœ‰ï¼‰ï¼ŒMySQL æ˜¯ä¸€ä¸ªæ”¯æŒå¤šå¼•æ“Žçš„ç³»ç»Ÿï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰å¤§å¼•æ“Žéƒ½æ”¯æŒäº‹åŠ¡ï¼Œæ¯”å¦‚ MySQL åŽŸç”Ÿçš„ MyISAM å¼•æ“Žå°±ä¸æ”¯æŒäº‹åŠ¡ï¼Œè¿™ä¹Ÿæ˜¯ MyISAM è¢« InnoDB å–ä»£çš„åŽŸå› ä¹‹ä¸€å§ã€‚

æ‰€ä»¥å°±ä»¥ InnoDB ä¸ºä¾‹ï¼Œä¸€èµ·å­¦ä¹ ä¸€ä¸‹ MySQL åœ¨äº‹åŠ¡æ”¯æŒæ–¹é¢çš„ç‰¹å®šå®žçŽ°ï¼Œå¹¶åŸºäºŽåŽŸç†ç»™å‡ºç”Ÿäº§åœºæ™¯çš„å®žè·µå»ºè®®ã€‚

### éš”ç¦»æ€§ä¸Žéš”ç¦»çº§åˆ«

ACID(Atomicity, Consisitency, Isolation, Durability)ï¼Œä»Šå¤©å…³æ³¨çš„æ˜¯å…¶ä¸­çš„ Isolationï¼Œéš”ç¦»æ€§ã€‚

å½“æ•°æ®åº“ä¸Šæœ‰å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œæ—¶ï¼Œå°±å¯èƒ½å‡ºçŽ° dirty read çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„è„è¯»ï¼Œè€Œä¸”ä¹Ÿæœ‰ä¸å¯é‡å¤è¯»(non-repeatable read)ã€å¹»è¯»(phantom read)çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå°±è¦å¼•å…¥**éš”ç¦»çº§åˆ«**çš„æ¦‚å¿µã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œéš”ç¦»æ€§è¶Šå¥½ï¼Œæ•ˆçŽ‡ä¹Ÿå°±è¶Šä½Žã€‚æ‰€ä»¥é€šå¸¸è¦åœ¨ä¸¤è€…ä¹‹é—´æ‰¾å¹³è¡¡ã€‚SQL æ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼š

- **è¯»æœªæäº¤**ï¼ˆread uncommittedï¼‰ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚
- **è¯»æäº¤**(read committed)ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åŽï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚
- **å¯é‡å¤è¯»**(repeatable read)ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚
- **ä¸²è¡ŒåŒ–**(serializable)ï¼Œå¯¹äºŽåŒä¸€è¡Œè®°å½•ï¼Œå†™ä¼šåŠ å†™é”ï¼Œè¯»ä¼šåŠ è¯»é”ã€‚å½“è¯»å†™é”å†²çªæ—¶ï¼ŒåŽè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚

ä¸¾ä¸€ä¸ªæ —å­ðŸŒ°ï¼Œå‡è®¾æ•°æ®è¡¨ T åªæœ‰ä¸€åˆ—ï¼Œå…¶ä¸­ä¸€è¡Œçš„å€¼ä¸º 1ï¼Œ ä¸‹é¢æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œä¸¤ä¸ªäº‹åŠ¡çš„è¡Œä¸ºã€‚

```sql
mysql> create table T(c int) engine=InnoDB;
insert into T(c) values(1);
```

timeline:

|        äº‹åŠ¡ A         |    äº‹åŠ¡ B    |
| :-------------------: | :----------: |
| å¯åŠ¨äº‹åŠ¡ æŸ¥è¯¢å¾—åˆ°å€¼ 1 |   å¯åŠ¨äº‹åŠ¡   |
|                       | æŸ¥è¯¢å¾—åˆ°å€¼ 1 |
|                       | å°† 1 æ”¹æˆ 2  |
|     æŸ¥è¯¢å¾—åˆ°å€¼ V1     |              |
|                       |  æäº¤äº‹åŠ¡ B  |
|     æŸ¥è¯¢å¾—åˆ°å€¼ V2     |              |
|      æäº¤äº‹åŠ¡ A       |              |
|     æŸ¥è¯¢å¾—åˆ°å€¼ V3     |              |

æˆ‘ä»¬çœ‹çœ‹åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ A ä¼šæœ‰å“ªäº›ä¸åŒçš„è¿”å›žç»“æžœï¼Œå³ V1ã€V2ã€V3 çš„å€¼éƒ½æ˜¯ä»€ä¹ˆã€‚

- **è¯»æœªæäº¤**ï¼šåˆ™ V1 çš„å€¼å°±æ˜¯ 2ã€‚è¿™æ—¶å€™äº‹åŠ¡ B è™½ç„¶è¿˜æ²¡æœ‰æäº¤ï¼Œä½†åšçš„å˜æ›´å·²ç»å¯ä»¥è¢«å…¶å®ƒäº‹åŠ¡çœ‹åˆ°ï¼Œæ‰€ä»¥ V2 ã€V3 ä¹Ÿæ˜¯ 2ã€‚
- **è¯»æäº¤**ï¼šV1 æ˜¯ 1ï¼ŒV2ã€V3 æ˜¯ 2ã€‚äº‹åŠ¡ B çš„æ›´æ–°åœ¨æäº¤åŽæ‰èƒ½è¢« A çœ‹åˆ°ã€‚
- **å¯é‡å¤è¯»**ï¼šV1 è‡ªç„¶æ˜¯1ï¼Œä½†è¿™é‡Œ V2 ä¹Ÿæ˜¯ 1ï¼Œå› ä¸ºäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œæäº¤äº‹åŠ¡ A åŽï¼Œæ­¤æ—¶äº‹åŠ¡ B ä¹Ÿå®Œæˆäº†ï¼ŒV3 çš„å€¼æ˜¯ 2ã€‚
- **ä¸²è¡ŒåŒ–**ï¼šäº‹åŠ¡ A æŸ¥è¯¢æ—¶è¯»é”ï¼Œäº‹åŠ¡ B æ‰§è¡Œå†™çš„æ—¶å€™å³å°† 1 æ”¹ä¸º 2 æ—¶ï¼Œå°±ä¼šè¢«é”ä½äº†ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤åŽï¼Œäº‹åŠ¡ B æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥ V1ã€V2 å€¼æ˜¯ 1ï¼ŒV3 çš„å€¼æ˜¯ 2ã€‚

å®ƒä»¬éƒ½æ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿå®žé™…ä¸Šï¼Œæ•°æ®åº“é‡Œä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œè®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘ç»“æžœä¸ºå‡†ã€‚åœ¨"å¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œæ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾ã€‚åœ¨â€œè¯»æäº¤â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ª SQL è¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºçš„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œâ€œè¯»æœªæäº¤â€éš”ç¦»çº§åˆ«ä¸‹ç›´æŽ¥è¿”å›žè®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œæ²¡æœ‰è§†å›¾æ¦‚å¿µï¼›â€œä¸²è¡ŒåŒ–â€éš”ç¦»çº§åˆ«ä¸‹ç›´æŽ¥ç”¨åŠ é”æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ã€‚

æ‰€ä»¥åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ•°æ®åº“è¡Œä¸ºæ˜¯æœ‰æ‰€ä¸åŒçš„ï¼Œå…¬å¸æœ‰äº›åº”ç”¨ä½¿ç”¨çš„æ˜¯ Oracle æ•°æ®åº“ï¼ŒOracle é»˜è®¤éš”ç¦»çº§åˆ«å°±æ˜¯"è¯»æäº¤"ï¼Œå› æ­¤åœ¨åŽ» IOE æ—¶ï¼Œè¿™äº›åº”ç”¨ä»Ž Oracle è¿ç§»åˆ° MySQLï¼Œä¸ºä¿è¯æ•°æ®éš”ç¦»çº§åˆ«çš„ä¸€è‡´ï¼Œä¸€å®šè¦å°† MySQL çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸º"è¯»æäº¤"ï¼Œæˆ–é€šè¿‡ä¸šåŠ¡é€»è¾‘è¯„ä¼°éš”ç¦»çº§åˆ«æ˜¯å¦å¯¹åº”ç”¨è¿ç§»æœ‰å½±å“ã€‚å…¬å¸å¦å¤–ç›¸å½“ä¸€éƒ¨åˆ†é‡è¦çš„åº”ç”¨è·‘åœ¨ DB2 æ•°æ®åº“ä¸Šï¼ŒDB2 é»˜è®¤éš”ç¦»çº§åˆ«ä¸º"æ¸¸æ ‡ç¨³å®šæ€§"ã€‚

> å½“ä½¿ç”¨æ¸¸æ ‡ç¨³å®šæ€§éš”ç¦»çº§åˆ«æ—¶ï¼Œäº‹åŠ¡é€šè¿‡æ¸¸æ ‡ä»Žè¡¨ä¸­æ£€ç´¢è¡Œæ—¶ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½æ›´æ–°æˆ–åˆ é™¤æ¸¸æ ‡æ‰€å¼•ç”¨çš„è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æžœè¢«é”å®šçš„è¡Œæœ¬èº«ä¸æ˜¯ç”¨ç´¢å¼•è®¿é—®çš„ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å¯ä»¥å°†æ–°çš„è¡Œæ·»åŠ åˆ°è¡¨ä¸­ï¼Œä»¥åŠå¯¹è¢«æ¸¸æ ‡é”å®šè¡Œå‰åŽçš„è¡Œè¿›è¡Œæ›´æ–°å’Œåˆ é™¤æ“ä½œã€‚æ‰€èŽ·å–çš„é”ä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°æ¸¸æ ‡é‡å®šä½æˆ–äº‹åŠ¡ç»ˆæ­¢ä¸ºæ­¢ï¼ˆå¦‚æžœæ¸¸æ ‡é‡å®šä½ï¼ŒåŽŸæ¥è¡Œä¸Šçš„é”å°±è¢«é‡Šæ”¾ï¼Œå¹¶èŽ·å¾—æ¸¸æ ‡çŽ°åœ¨å¼•ç”¨çš„è¡Œä¸Šçš„é”ï¼‰

è¿™ä¸ªè¿˜æœ‰äº›ç»†èŠ‚ä¸ç”šæ¸…æ¥šï¼Œç­‰ç ”ç©¶æ˜Žç™½äº†å†å¡«å‘ã€‚

è¯´å›žåœ¨ MySQL ä¸­çš„é…ç½®æ–¹å¼ï¼Œé€šè¿‡å¯åŠ¨å‚æ•° transaction_isolation è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚"è¯»æäº¤"ï¼Œå‚æ•°å€¼è®¾ç½®ä¸º READ-COMMITTEDã€‚

### äº‹åŠ¡éš”ç¦»çš„å®žçŽ°

MySQL ä¸­æ¯æ¡è®°å½•åœ¨æ›´æ–°æ—¶éƒ½ä¼šè®°å½•ä¸€æ¡å›žæ»šæ“ä½œï¼Œè®°å½•ä¸Šçš„æœ€æ–°å€¼é€šè¿‡å›žæ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚

åœ¨æŸ¥è¯¢ä¸€æ¡è®°å½•æ—¶ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„ read-viewï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ MVCCã€‚

å›žæ»šæ—¥å¿—è‚¯å®šä¹Ÿä¸æ˜¯æ°¸è¿œä¿ç•™çš„ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­å½“æ²¡æœ‰äº‹åŠ¡éœ€è¦ç”¨åˆ°è¿™äº›å›žæ»šæ—¥å¿—æ—¶ï¼Œå›žæ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›žæ»šæ—¥å¿—æ›´æ—©çš„ read-view çš„æ—¶å€™ã€‚

æ‰€ä»¥æœ‰ä¸ªé—®é¢˜ï¼Œé•¿äº‹åŠ¡ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨ï¼Ÿé•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ï¼Œç”±äºŽè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›žæ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œæ— ç–‘ä¼šå¯¼è‡´ç©ºé—´è¢«å¤§é‡å ç”¨ã€‚

### äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼

é¡¹ç›®ä¸­åº”ç”¨å¼€å‘äººå‘˜ä¸€èˆ¬ä¹Ÿå¹¶ä¸ä¼šæ•…æ„ä½¿ç”¨é•¿äº‹åŠ¡ï¼ˆèƒ½äº†è§£åŽŸç†å¹¶æ•…æ„ä½¿ç”¨çš„å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¹Ÿç•™ä¸ä½â€¦å½“ç„¶æ•°æ®åº“å¼€å‘äººå‘˜é™¤å¤–ï¼‰ï¼Œæ‰€ä»¥å®žé™…æƒ…å†µæ˜¯è¯¯ç”¨çš„å¯èƒ½æ€§ä¼šå¤§ä¸€ç‚¹ã€‚äº‹åŠ¡å¯åŠ¨æ–¹å¼åœ¨ MySQL æ˜¯è¿™æ ·çš„ï¼š

1. æ˜¾ç¤ºå¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œbegin æˆ– start transactionã€‚é…å¥—çš„æäº¤è¯­å¥æ˜¯ commitï¼Œå›žæ»šè¯­å¥æ˜¯ rollbackã€‚
2. set autocommit = 0ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æŽ‰ï¼Œæ„å‘³ç€å¦‚æžœä½ åªæ‰§è¡Œä¸€ä¸ª select è¯­å¥ï¼Œè¿™ä¸ªäº‹åŠ¡å°±å¯åŠ¨äº†ï¼Œè€Œä¸”ä¸ä¼šè‡ªåŠ¨æäº¤ã€‚è¿™ä¸ªäº‹åŠ¡æŒç»­å­˜åœ¨ç›´åˆ°ä½ ä¸»åŠ¨æ‰§è¡Œ commit æˆ– rollback è¯­å¥ï¼Œæˆ–è€…æ–­å¼€è¿žæŽ¥ã€‚

æœ‰äº›å®¢æˆ·ç«¯è¿žæŽ¥ä¼šé»˜è®¤è¿žæŽ¥æˆåŠŸåŽå…ˆæ‰§è¡Œä¸€ä¸ª set autocommit = 0 çš„å‘½ä»¤ã€‚è¿™å°±å¯¼è‡´æŽ¥ä¸‹æ¥çš„æŸ¥è¯¢éƒ½åœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æžœæ˜¯é•¿è¿žæŽ¥å°±å¯¼è‡´äº†æ„å¤–çš„é•¿äº‹åŠ¡ã€‚

æ‰€ä»¥å¯ä»¥æ€»æ˜¯é€šè¿‡æ˜¾ç¤ºè¯­å¥ set autocommit = 1 æ¥å¯åŠ¨äº‹åŠ¡æ¥é¿å…ã€‚ä½†ç¼ºç‚¹å°±æ˜¯äº§ç”Ÿäº†"å¤šä¸€æ¬¡äº¤äº’"é—®é¢˜ï¼Œå› ä¸ºåœ¨ç¬¬ 2 ç§æ–¹æ³•ä¸­ä¸ç”¨æ¯æ¬¡éƒ½ä¸»åŠ¨æ‰§è¡Œ begin äº†ï¼Œå‡å°‘äº†è¯­å¥çš„äº¤äº’æ¬¡æ•°ã€‚è§£å†³åŠžæ³•æ˜¯ä½¿ç”¨ commit work and chain çš„è¯­æ³•ï¼šç”¨ begin æ˜¾ç¤ºå¯åŠ¨çš„äº‹åŠ¡ï¼Œcommit work and chain æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·å°±çœåŽ»çš„å†æ¬¡æ‰§è¡Œ begin è¯­å¥çš„å¼€é”€ï¼Œé¢å¤–çš„å¥½å¤„æ˜¯ä»Žç¨‹åºå¼€å‘çš„è§’åº¦æ˜Žç¡®çŸ¥é“æ¯ä¸ªè¯­å¥æ˜¯å¦å¤„äºŽäº‹åŠ¡ä¸­ã€‚

åœ¨ information_schema åº“çš„ innodb_trx è¿™ä¸ªè¡¨ä¸­å¯ä»¥æŸ¥è¯¢é•¿äº‹åŠ¡ï¼Œä¾‹å¦‚æŸ¥è¯¢æŒç»­æ—¶é—´è¶…è¿‡ 100s çš„äº‹åŠ¡ã€‚

```sql
mysql> select * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))>100

```

###















